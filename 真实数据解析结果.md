# 真实数据解析结果演示

## 输入：真实回传的JSON

```json
{
  "robustness": {
    "corruption": [
      {"severity": 1, "corruption_key": "gaussian_noise_severity_1", "corruption_name": "gaussian_noise", "performance_drop_rate": 0.10150171837957254, "perturbation_magnitude": 0.039590768463909624, "perturbation_tolerance": 0.7197211733952948},
      {"severity": 3, "corruption_key": "gaussian_noise_severity_3", "corruption_name": "gaussian_noise", ...},
      {"severity": 5, "corruption_key": "gaussian_noise_severity_5", "corruption_name": "gaussian_noise", ...},
      {"severity": 1, "corruption_key": "gaussian_blur_severity_1", "corruption_name": "gaussian_blur", ...},
      {"severity": 3, "corruption_key": "gaussian_blur_severity_3", "corruption_name": "gaussian_blur", ...},
      {"severity": 5, "corruption_key": "gaussian_blur_severity_5", "corruption_name": "gaussian_blur", ...},
      {"severity": 1, "corruption_key": "brightness_shift_severity_1", "corruption_name": "brightness_shift", ...},
      {"severity": 3, "corruption_key": "brightness_shift_severity_3", "corruption_name": "brightness_shift", ...},
      {"severity": 5, "corruption_key": "brightness_shift_severity_5", "corruption_name": "brightness_shift", ...},
      {"severity": 1, "corruption_key": "contrast_shift_severity_1", "corruption_name": "contrast_shift", ...},
      {"severity": 3, "corruption_key": "contrast_shift_severity_3", "corruption_name": "contrast_shift", ...},
      {"severity": 5, "corruption_key": "contrast_shift_severity_5", "corruption_name": "contrast_shift", ...}
    ],
    "adversarial": [
      {
        "eps": 0.1,
        "attack": "fgsm",
        "metrics": {
          "clean_map": 0.8594224333079387,
          "miss_rate": 0.4809758931164682,
          "map_drop_rate": 0.6018151662023413,
          "adversarial_map": 0.34220897876870093,
          "clean_miss_rate": 0.22887017136218415,
          "per_class_clean_map": {"1": 0.985, "2": 0.941, ..., "20": 0.933},
          "false_detection_rate": 0.6759746146872166,
          "per_class_adversarial_map": {"1": 0.558, "2": 0.091, ..., "20": 0.061},
          "clean_false_detection_rate": 0.44629822732012514
        }
      },
      {
        "steps": 1,
        "attack": "pgd",
        "metrics": {
          "clean_map": 0.8594224333079387,
          "miss_rate": 0.4774905605576532,
          "map_drop_rate": 0.603745830620589,
          "adversarial_map": 0.34054972245646953,
          "clean_miss_rate": 0.22887017136218415,
          "per_class_clean_map": {"1": 0.985, "2": 0.941, ..., "20": 0.933},
          "false_detection_rate": 0.6772515249372084,
          "per_class_adversarial_map": {"1": 0.546, "2": 0.109, ..., "20": 0.068},
          "clean_false_detection_rate": 0.44629822732012514
        }
      }
    ]
  }
}
```

---

## 解析过程

### 步骤1: 检查触发条件
```java
result.containsKey("robustness")  // true
```
✅ 触发 `parseAndStoreRobustness()`

### 步骤2: 解析 robustness JSON
```java
JsonNode rootNode = objectMapper.readTree(robustnessJson);
// robustnessJson 是将上面的对象序列化后的字符串
```

---

## 部分A: Adversarial 攻击解析

### A1. FGSM 攻击 (eps=0.1)

**构造攻击名称**:
```
attack = "fgsm"
has("eps") = true
eps = 0.1
➜ attackName = "fgsm_eps_0.1"
```

**提取 metrics 节点**:
```java
metricsNode = attack.get("metrics")  // 提取 metrics 对象
```

**黑名单过滤**:
```
excludedFields = ["attack", "eps", "steps", "attack_name"]
```

**遍历 metrics 中的所有字段**:

| 序号 | 字段名 | 类型 | 是否排除 | 生成键名 | 存储值 |
|------|--------|------|---------|---------|--------|
| 1 | clean_map | 标量 | ❌ | clean_map_fgsm_eps_0.1 | "0.8594224333079387" |
| 2 | miss_rate | 标量 | ❌ | miss_rate_fgsm_eps_0.1 | "0.4809758931164682" |
| 3 | map_drop_rate | 标量 | ❌ | map_drop_rate_fgsm_eps_0.1 | "0.6018151662023413" |
| 4 | adversarial_map | 标量 | ❌ | adversarial_map_fgsm_eps_0.1 | "0.34220897876870093" |
| 5 | clean_miss_rate | 标量 | ❌ | clean_miss_rate_fgsm_eps_0.1 | "0.22887017136218415" |
| 6 | per_class_clean_map | 对象 | ❌ | per_class_clean_map_fgsm_eps_0.1 | "{\"1\":0.9853843204907036,\"2\":0.9407952437173216,...}" |
| 7 | false_detection_rate | 标量 | ❌ | false_detection_rate_fgsm_eps_0.1 | "0.6759746146872166" |
| 8 | per_class_adversarial_map | 对象 | ❌ | per_class_adversarial_map_fgsm_eps_0.1 | "{\"1\":0.5576004029512011,\"2\":0.0910130026977853,...}" |
| 9 | clean_false_detection_rate | 标量 | ❌ | clean_false_detection_rate_fgsm_eps_0.1 | "0.44629822732012514" |

**FGSM 存储: 9 个字段**

### A2. PGD 攻击 (steps=1)

**构造攻击名称**:
```
attack = "pgd"
has("eps") = false
has("steps") = true
steps = 1
➜ attackName = "pgd_steps_1"
```

**metrics 字段解析**:

| 序号 | 字段名 | 生成键名 | 存储值类型 |
|------|--------|---------|----------|
| 10 | clean_map | clean_map_pgd_steps_1 | "0.8594224333079387" |
| 11 | miss_rate | miss_rate_pgd_steps_1 | "0.4774905605576532" |
| 12 | map_drop_rate | map_drop_rate_pgd_steps_1 | "0.603745830620589" |
| 13 | adversarial_map | adversarial_map_pgd_steps_1 | "0.34054972245646953" |
| 14 | clean_miss_rate | clean_miss_rate_pgd_steps_1 | "0.22887017136218415" |
| 15 | per_class_clean_map | per_class_clean_map_pgd_steps_1 | JSON字符串（20个类别）|
| 16 | false_detection_rate | false_detection_rate_pgd_steps_1 | "0.6772515249372084" |
| 17 | per_class_adversarial_map | per_class_adversarial_map_pgd_steps_1 | JSON字符串（20个类别）|
| 18 | clean_false_detection_rate | clean_false_detection_rate_pgd_steps_1 | "0.44629822732012514" |

**PGD 存储: 9 个字段**

**Adversarial 小计: 18 个字段**

---

## 部分B: Corruption 腐败测试解析

共有 **12 个测试**（4种腐败类型 × 3个严重程度）

**黑名单**:
```
excludedFields = ["corruption_name", "corruption_key", "severity"]
```

每个测试存储 **3 个指标字段**：
- performance_drop_rate
- perturbation_magnitude
- perturbation_tolerance

### B1. Gaussian Noise (3个测试)

| 序号 | Severity | 后缀 | 字段名 | 生成键名 | 值 |
|------|----------|------|--------|---------|-----|
| 19 | 1 | gaussian_noise_1 | performance_drop_rate | performance_drop_rate_gaussian_noise_1 | "0.10150171837957254" |
| 20 | 1 | gaussian_noise_1 | perturbation_magnitude | perturbation_magnitude_gaussian_noise_1 | "0.039590768463909624" |
| 21 | 1 | gaussian_noise_1 | perturbation_tolerance | perturbation_tolerance_gaussian_noise_1 | "0.7197211733952948" |
| 22 | 3 | gaussian_noise_3 | performance_drop_rate | performance_drop_rate_gaussian_noise_3 | "0.5187301846502559" |
| 23 | 3 | gaussian_noise_3 | perturbation_magnitude | perturbation_magnitude_gaussian_noise_3 | "0.1148813260793686" |
| 24 | 3 | gaussian_noise_3 | perturbation_tolerance | perturbation_tolerance_gaussian_noise_3 | "0.5759512053441767" |
| 25 | 5 | gaussian_noise_5 | performance_drop_rate | performance_drop_rate_gaussian_noise_5 | "0.7548621134994921" |
| 26 | 5 | gaussian_noise_5 | perturbation_magnitude | perturbation_magnitude_gaussian_noise_5 | "0.17979797956347465" |
| 27 | 5 | gaussian_noise_5 | perturbation_tolerance | perturbation_tolerance_gaussian_noise_5 | "0.4153354632587859" |

### B2. Gaussian Blur (3个测试)

| 序号 | 生成键名 | 值 |
|------|---------|-----|
| 28 | performance_drop_rate_gaussian_blur_1 | "0.03713639500993364" |
| 29 | perturbation_magnitude_gaussian_blur_1 | "0.01627748817531392" |
| 30 | perturbation_tolerance_gaussian_blur_1 | "0.745570723206506" |
| 31 | performance_drop_rate_gaussian_blur_3 | "0.3773218217779768" |
| 32 | perturbation_magnitude_gaussian_blur_3 | "0.03400290993973613" |
| 33 | perturbation_tolerance_gaussian_blur_3 | "0.4975312227708394" |
| 34 | performance_drop_rate_gaussian_blur_5 | "0.712059080532761" |
| 35 | perturbation_magnitude_gaussian_blur_5 | "0.04162775518372655" |
| 36 | perturbation_tolerance_gaussian_blur_5 | "0.2518152773743828" |

### B3. Brightness Shift (3个测试)

| 序号 | 生成键名 | 值 |
|------|---------|-----|
| 37 | performance_drop_rate_brightness_shift_1 | "0.016172248993107624" |
| 38 | perturbation_magnitude_brightness_shift_1 | "0.0936555516794324" |
| 39 | perturbation_tolerance_brightness_shift_1 | "0.7650304966598896" |
| 40 | performance_drop_rate_brightness_shift_3 | "0.12181816556619048" |
| 41 | perturbation_magnitude_brightness_shift_3 | "0.250279966250062" |
| 42 | perturbation_tolerance_brightness_shift_3 | "0.7051989544002324" |
| 43 | performance_drop_rate_brightness_shift_5 | "0.31256928359131125" |
| 44 | perturbation_magnitude_brightness_shift_5 | "0.3597620586454868" |
| 45 | perturbation_tolerance_brightness_shift_5 | "0.6195178623293639" |

### B4. Contrast Shift (3个测试)

| 序号 | 生成键名 | 值 |
|------|---------|-----|
| 46 | performance_drop_rate_contrast_shift_1 | "0.003668013223334525" |
| 47 | perturbation_magnitude_contrast_shift_1 | "0.02372101335972547" |
| 48 | perturbation_tolerance_contrast_shift_1 | "0.7629973860005809" |
| 49 | performance_drop_rate_contrast_shift_3 | "0.044072069006883034" |
| 50 | perturbation_magnitude_contrast_shift_3 | "0.07116304077580571" |
| 51 | perturbation_tolerance_contrast_shift_3 | "0.7139122857972698" |
| 52 | performance_drop_rate_contrast_shift_5 | "0.47365063740852453" |
| 53 | perturbation_magnitude_contrast_shift_5 | "0.10674456183612346" |
| 54 | perturbation_tolerance_contrast_shift_5 | "0.48649433633459194" |

**Corruption 小计: 36 个字段**

---

## 最终数据库存储结果

### 表: `model_evaluation`
### 列: `robustnessResult`
### 总字段数: **54 个**

```json
{
  // ========== FGSM 攻击 (9个字段) ==========
  "clean_map_fgsm_eps_0.1": "0.8594224333079387",
  "miss_rate_fgsm_eps_0.1": "0.4809758931164682",
  "map_drop_rate_fgsm_eps_0.1": "0.6018151662023413",
  "adversarial_map_fgsm_eps_0.1": "0.34220897876870093",
  "clean_miss_rate_fgsm_eps_0.1": "0.22887017136218415",
  "per_class_clean_map_fgsm_eps_0.1": "{\"1\":0.9853843204907036,\"2\":0.9407952437173216,\"3\":0.9693586213605374,\"4\":0.8560488272276428,\"5\":0.6006356780816812,\"6\":0.9943019943019942,\"7\":0.7587982932413867,\"8\":0.9859907910475016,\"9\":0.8768796992481203,\"10\":0.921875,\"11\":0.9811617998915912,\"12\":0.6301713428509116,\"13\":0.8229207077096072,\"14\":0.6303784804252734,\"15\":1,\"16\":0.932362538340971,\"17\":0.9942919923895724,\"18\":0.5625434410014456,\"19\":0.8117117659199726,\"20\":0.9328381289125393}",
  "false_detection_rate_fgsm_eps_0.1": "0.6759746146872166",
  "per_class_adversarial_map_fgsm_eps_0.1": "{\"1\":0.5576004029512011,\"2\":0.0910130026977853,\"3\":0.8881121584149567,\"4\":0.3452359267397436,\"5\":0.19877182706466592,\"6\":0.21428571428571427,\"7\":0.10961776560153844,\"8\":0.04906832298136645,\"9\":0.1,\"10\":0.010416666666666666,\"11\":0.5030102683569605,\"12\":0.3996987024651791,\"13\":0.34122023809523816,\"14\":0.49099668020267495,\"15\":0.7984193957204905,\"16\":0.7298676543054099,\"17\":0.6865808590893422,\"18\":0.029411764705882353,\"19\":0.24003149681405092,\"20\":0.06082072821515152}",
  "clean_false_detection_rate_fgsm_eps_0.1": "0.44629822732012514",

  // ========== PGD 攻击 (9个字段) ==========
  "clean_map_pgd_steps_1": "0.8594224333079387",
  "miss_rate_pgd_steps_1": "0.4774905605576532",
  "map_drop_rate_pgd_steps_1": "0.603745830620589",
  "adversarial_map_pgd_steps_1": "0.34054972245646953",
  "clean_miss_rate_pgd_steps_1": "0.22887017136218415",
  "per_class_clean_map_pgd_steps_1": "{\"1\":0.9853843204907036,...,\"20\":0.9328381289125393}",
  "false_detection_rate_pgd_steps_1": "0.6772515249372084",
  "per_class_adversarial_map_pgd_steps_1": "{\"1\":0.5458471300015795,...,\"20\":0.06788959527056591}",
  "clean_false_detection_rate_pgd_steps_1": "0.44629822732012514",

  // ========== Gaussian Noise (9个字段) ==========
  "performance_drop_rate_gaussian_noise_1": "0.10150171837957254",
  "perturbation_magnitude_gaussian_noise_1": "0.039590768463909624",
  "perturbation_tolerance_gaussian_noise_1": "0.7197211733952948",
  "performance_drop_rate_gaussian_noise_3": "0.5187301846502559",
  "perturbation_magnitude_gaussian_noise_3": "0.1148813260793686",
  "perturbation_tolerance_gaussian_noise_3": "0.5759512053441767",
  "performance_drop_rate_gaussian_noise_5": "0.7548621134994921",
  "perturbation_magnitude_gaussian_noise_5": "0.17979797956347465",
  "perturbation_tolerance_gaussian_noise_5": "0.4153354632587859",

  // ========== Gaussian Blur (9个字段) ==========
  "performance_drop_rate_gaussian_blur_1": "0.03713639500993364",
  "perturbation_magnitude_gaussian_blur_1": "0.01627748817531392",
  "perturbation_tolerance_gaussian_blur_1": "0.745570723206506",
  "performance_drop_rate_gaussian_blur_3": "0.3773218217779768",
  "perturbation_magnitude_gaussian_blur_3": "0.03400290993973613",
  "perturbation_tolerance_gaussian_blur_3": "0.4975312227708394",
  "performance_drop_rate_gaussian_blur_5": "0.712059080532761",
  "perturbation_magnitude_gaussian_blur_5": "0.04162775518372655",
  "perturbation_tolerance_gaussian_blur_5": "0.2518152773743828",

  // ========== Brightness Shift (9个字段) ==========
  "performance_drop_rate_brightness_shift_1": "0.016172248993107624",
  "perturbation_magnitude_brightness_shift_1": "0.0936555516794324",
  "perturbation_tolerance_brightness_shift_1": "0.7650304966598896",
  "performance_drop_rate_brightness_shift_3": "0.12181816556619048",
  "perturbation_magnitude_brightness_shift_3": "0.250279966250062",
  "perturbation_tolerance_brightness_shift_3": "0.7051989544002324",
  "performance_drop_rate_brightness_shift_5": "0.31256928359131125",
  "perturbation_magnitude_brightness_shift_5": "0.3597620586454868",
  "perturbation_tolerance_brightness_shift_5": "0.6195178623293639",

  // ========== Contrast Shift (9个字段) ==========
  "performance_drop_rate_contrast_shift_1": "0.003668013223334525",
  "perturbation_magnitude_contrast_shift_1": "0.02372101335972547",
  "perturbation_tolerance_contrast_shift_1": "0.7629973860005809",
  "performance_drop_rate_contrast_shift_3": "0.044072069006883034",
  "perturbation_magnitude_contrast_shift_3": "0.07116304077580571",
  "perturbation_tolerance_contrast_shift_3": "0.7139122857972698",
  "performance_drop_rate_contrast_shift_5": "0.47365063740852453",
  "perturbation_magnitude_contrast_shift_5": "0.10674456183612346",
  "perturbation_tolerance_contrast_shift_5": "0.48649433633459194"
}
```

---

## 统计总结

| 类别 | 测试数量 | 字段/测试 | 总字段数 |
|------|---------|----------|---------|
| FGSM 攻击 | 1 | 9 | 9 |
| PGD 攻击 | 1 | 9 | 9 |
| Gaussian Noise | 3 | 3 | 9 |
| Gaussian Blur | 3 | 3 | 9 |
| Brightness Shift | 3 | 3 | 9 |
| Contrast Shift | 3 | 3 | 9 |
| **总计** | **14** | - | **54** |

---

## 关键特性验证

### ✅ 1. 攻击方法可识别
```
键名: "clean_map_fgsm_eps_0.1"
  ➜ 攻击: fgsm
  ➜ 参数: eps = 0.1
  ➜ 指标: clean_map

键名: "miss_rate_pgd_steps_1"
  ➜ 攻击: pgd
  ➜ 参数: steps = 1
  ➜ 指标: miss_rate
```

### ✅ 2. 腐败类型可识别
```
键名: "performance_drop_rate_gaussian_noise_5"
  ➜ 腐败: gaussian_noise
  ➜ 严重程度: 5
  ➜ 指标: performance_drop_rate
```

### ✅ 3. 嵌套对象正确处理
```
per_class_clean_map_fgsm_eps_0.1:
  "{\"1\":0.985,\"2\":0.941,...,\"20\":0.933}"
  (包含20个类别的JSON字符串)
```

### ✅ 4. 没有信息丢失
- 所有 adversarial 指标: **18/18** ✅
- 所有 corruption 指标: **36/36** ✅
- 总计: **54/54** ✅

### ✅ 5. 格式与其他维度一致
- 扁平化键值对 ✅
- 键名包含攻击/腐败类型 ✅
- 值为字符串或JSON字符串 ✅

---

## 数据库中不会出现的内容

### ❌ 不会有这些键:
```json
{
  "robustness": "...",     // ❌ 不会有
  "adversarial": "...",    // ❌ 不会有
  "corruption": "...",     // ❌ 不会有
  "attack": "fgsm",        // ❌ 不会有（黑名单）
  "eps": "0.1",            // ❌ 不会有（黑名单）
  "corruption_name": "...", // ❌ 不会有（黑名单）
  "severity": "1"          // ❌ 不会有（黑名单）
}
```

### ✅ 只会有这些键:
```json
{
  "指标名_攻击类型_参数类型_参数值": "指标值",
  "指标名_腐败类型_严重程度": "指标值"
}
```

---

## 结论

基于这个**真实数据**，我的解析代码会：
1. ✅ 展开存储 **54 个指标字段**
2. ✅ 每个字段都能识别对应的攻击/腐败方法
3. ✅ 嵌套对象（per_class_*）正确序列化
4. ✅ 格式与其他评测维度保持一致
5. ✅ **没有任何信息丢失**

旧方法只能存储 12 个字段（adversarial只存3个×2 + corruption只存3个×4），**丢失42个字段**。
新方法存储全部 54 个字段，**丢失0个字段**。
