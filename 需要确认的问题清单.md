# 需要确认的问题清单

## 问题 1：resultColumn 的实际值是什么？⚠️

### 代码逻辑（K8sImpl.java:171）：
```java
values.put("resultColumn", evaluationType+"Result");
```

这意味着 `resultColumn` 格式应该是：`"{evaluationType}Result"`

### 你提供的 JSON：
```json
{
  "resultColumn": "object_detection_basic",  // ⚠️ 不符合代码规则
  "result": {
    "robustness": { ... }
  }
}
```

### 预期格式应该是：
- 鲁棒性维度：`"robustnessResult"`
- 基础维度：`"basicResult"`
- 可解释性维度：`"interpretabilityResult"`
- 泛化性维度：`"generalizationResult"`
- 公平性维度：`"fairnessResult"`
- 安全性维度：`"safetyResult"`

### 我的代码判断（EvaluationResultServiceImpl.java:377）：
```java
if ("robustnessResult".equals(resultColumn) && result.containsKey("robustness")) {
    parseAndStoreRobustness(modelId, resultColumn, result.get("robustness"));
    return;
}
```

**❌ 如果 resultColumn = "object_detection_basic"，不会触发特殊解析！**

---

## 问题 2：result 的数据格式

### 方法签名：
```java
public void updateResult(Long modelId, Map<String, String> result, String resultColumn)
//                                      ^^^^^^^^^^^^^^^^ value 必须是 String
```

### 你提供的 JSON（嵌套对象）：
```json
{
  "result": {
    "robustness": {
      "adversarial": [...],
      "corruptions": [...]
    }
  }
}
```

### 实际传输时（Spring 自动序列化）：
```json
{
  "result": {
    "robustness": "{\"adversarial\":[...],\"corruptions\":[...]}"
  }
}
```

**✅ 这个没问题，Spring 会自动处理**

---

## 问题 3：目标检测任务的鲁棒性数据应该用什么 resultColumn？

### 可能的场景：

#### 场景 A：目标检测的鲁棒性评测
- evaluationType = `"robustness"`
- resultColumn = `"robustnessResult"`
- result 包含 `{"robustness": "{...}"}`
- ✅ **会触发我的特殊解析**

#### 场景 B：目标检测的基础评测（但包含鲁棒性数据？）
- evaluationType = `"object_detection_basic"`
- resultColumn = `"object_detection_basicResult"`
- result 包含 `{"robustness": "{...}"}`
- ❌ **不会触发我的特殊解析**

---

## 需要你确认的问题

### Q1: 评测模块回传鲁棒性数据时，实际的 resultColumn 值是什么？
- [ ] `"robustnessResult"` ✅ 符合我的代码
- [ ] `"object_detection_basic"` 或 `"object_detection_basicResult"` ❌ 不符合
- [ ] 其他：`___________`

### Q2: "object_detection_basic" 是什么意思？
- [ ] 这是任务类型标识（task = detection）
- [ ] 这是 evaluationType 的值
- [ ] 这只是示例，实际会传 "robustnessResult"
- [ ] 其他：`___________`

### Q3: 目标检测模型的鲁棒性评测，evaluationType 是什么？
- [ ] `"robustness"` → resultColumn = `"robustnessResult"`
- [ ] `"object_detection_robustness"` → resultColumn = `"object_detection_robustnessResult"`
- [ ] 其他：`___________`

---

## 可能的解决方案

### 方案 1：放宽判断条件（推荐）⭐

修改 `EvaluationResultServiceImpl.java:377` 行：

```java
// 旧代码（严格匹配）
if ("robustnessResult".equals(resultColumn) && result.containsKey("robustness")) {

// 新代码（宽松匹配）
if (result.containsKey("robustness")) {
    // 只要 result 包含 "robustness" 键，就触发特殊解析
    // resultColumn 可以是任意值（robustnessResult, object_detection_basicResult 等）
    parseAndStoreRobustness(modelId, resultColumn, result.get("robustness"));
    return;
}
```

**优点**：
- ✅ 兼容所有可能的 resultColumn 值
- ✅ 只要数据包含 robustness，就正确解析
- ✅ 不需要修改评测模块

**缺点**：
- ⚠️ 如果其他维度误传 robustness 字段，也会被特殊处理

### 方案 2：支持多个 resultColumn 值

```java
// 支持多种 resultColumn 格式
Set<String> robustnessColumns = new HashSet<>(Arrays.asList(
    "robustnessResult",
    "object_detection_robustnessResult",
    "object_detection_basicResult"  // 如果确实会用这个
));

if (robustnessColumns.contains(resultColumn) && result.containsKey("robustness")) {
    parseAndStoreRobustness(modelId, resultColumn, result.get("robustness"));
    return;
}
```

### 方案 3：修改评测模块

确保评测模块回传时：
- 鲁棒性数据 → `resultColumn = "robustnessResult"`
- 基础评测数据 → `resultColumn = "basicResult"`

---

## 我的建议

**请先告诉我实际的 resultColumn 值**，然后我会选择正确的修改方案。

如果不确定，我建议采用 **方案 1（放宽判断条件）**，这样最保险。
